"use strict";const e=require("vue"),F=require("../../../utils/create.js"),y=require("./utils.js"),I=require("../../../../node_modules/.pnpm/@vueuse_core@12.8.2_typescript@5.8.2/node_modules/@vueuse/core/index.js"),M=["value","placeholder","disabled"],O=e.defineComponent({name:"tl-textarea",__name:"textarea",props:{id:{default:""},modelValue:{default:""},placeholder:{default:""},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},showWordLimit:{type:Boolean,default:!1},maxLength:{default:0},autoSize:{}},emits:["update:modelValue","input","change","clear","focus","blur"],setup(R,{emit:L}){const l=F.createNamespace("textarea"),o=R,n=L,s=e.computed(()=>o.modelValue),r=e.shallowRef(),m=e.ref(),_=e.computed(()=>o.showWordLimit?`${s.value?s.value.toString().length:0}/${o.maxLength}`:""),i=e.ref(!1),N=t=>{i.value=!0,n("focus",t)},H=t=>{i.value=!1,n("blur",t)},E=t=>{if(o.disabled||d.value)return;const{value:a}=t.target;C(a)},b=t=>{o.modelValue!==t&&!i.value&&n("change",t)},q=e.computed(()=>o.clearable&&s.value),A=()=>{n("clear",""),b(""),n("update:modelValue","")},d=e.ref(!1),f=t=>{const{value:a}=t.target;t.type==="compositionend"?(d.value=!1,C(a)):d.value=!0},C=t=>{let a=t;o.maxLength&&t.length>o.maxLength&&(a=t.slice(0,Math.max(0,o.maxLength)),r.value.value=a),b(a),n("input",a),n("update:modelValue",a)},S=e.ref(),p=e.ref(0);let u;const z=e.ref();e.onMounted(()=>{u=getComputedStyle(r.value,null),o.autoSize&&(z.value=y.getSizeStyles(u)),p.value=y.splitUnit(u.getPropertyValue("line-height")),h()}),e.watch(()=>o.modelValue,()=>h());const h=async()=>{var w,B;if(!o.autoSize)return;await e.nextTick();let t,a,c="hidden";const k=(w=o.autoSize)==null?void 0:w.minRows,x=(B=o.autoSize)==null?void 0:B.maxRows,{pt:W,pb:$,bw:D}=y.getOutProp(u),V=W+$+D,v=m.value.offsetHeight;k&&(t=p.value*k+V),x&&(a=p.value*x+V);let g=v??0;t&&v<t&&(g=t),a&&v>a&&(g=a,c="auto"),S.value={height:`${g}px`,resize:o.autoSize?"none":"vertical",overflow:c}};return I.useResizeObserver(r,h),(t,a)=>{const c=e.resolveComponent("tl-icon");return e.openBlock(),e.createElementBlock("div",{ref_key:"contentRef",ref:m,class:e.normalizeClass([e.unref(l).b(),e.unref(l).is("disabled",t.disabled),e.unref(l).is("focus",i.value)])},[o.autoSize?(e.openBlock(),e.createElementBlock("div",{key:0,ref_key:"contentRef",ref:m,style:e.normalizeStyle(z.value),class:e.normalizeClass([e.unref(l).e("content")])},e.toDisplayString(t.modelValue),7)):e.createCommentVNode("",!0),o.showWordLimit?(e.openBlock(),e.createElementBlock("span",{key:1,class:e.normalizeClass(e.unref(l).e("wordLimit"))},e.toDisplayString(_.value),3)):e.createCommentVNode("",!0),e.createElementVNode("textarea",{ref_key:"textAreaRef",ref:r,value:s.value,rows:"5",cols:"",placeholder:t.placeholder,class:e.normalizeClass([e.unref(l).e("inner")]),disabled:t.disabled,style:e.normalizeStyle(S.value),onFocus:N,onBlur:H,onInput:E,onCompositionstart:f,onCompositionupdate:f,onCompositionend:f},null,46,M),q.value&&!t.disabled?(e.openBlock(),e.createElementBlock("button",{key:2,"aria-label":"清空内容",class:e.normalizeClass(e.unref(l).e("button")),onClick:A},[e.createVNode(c,{icon:"fa-solid fa-xmark "})],2)):e.createCommentVNode("",!0)],2)}}});module.exports=O;
