"use strict";const e=require("vue"),T=require("../../../utils/create.js"),u=require("../../../utils/utils.js"),k=require("./utils.js"),q=require("./hook/use-img-scale.js"),R=require("./hook/use-img-drag.js"),M=["src"],p=90,O=e.defineComponent({name:"tl-image-preview",__name:"preview",props:{visible:{type:Boolean},src:{},closable:{type:Boolean,default:!0},maskClosable:{type:Boolean,default:!0},previewGroup:{type:Boolean,default:!1},popupContainer:{},unmountOnClose:{type:Boolean,default:!1},onCancel:{}},emits:["update:visible","onNext","onPrev"],setup(g,{emit:x}){const t=T.createNamespace("image-preview"),o=g,m=x,d=e.ref(o.visible),r=e.ref(0),l=e.ref();e.onMounted(()=>l.value=k.getPopupContainer(o.popupContainer));const f=e.ref(),v=e.ref(),V=e.computed(()=>l.value===document.body),w=e.computed(()=>({...V.value?{zIndex:u.popupManager.nextIndex()}:{zIndex:"inherit",position:"absolute",height:"100%"}}));e.watch(()=>o.visible,n=>{!n&&o.unmountOnClose?d.value=!1:d.value=!0,l.value&&(n?l.value.style.overflow="hidden":l.value.style.overflow="")});const{scale:c,resetScale:z,adjustZoom:C}=q(e.reactive({wrapperEl:v})),{translate:b,resetTranslate:E}=R(e.reactive({imageEl:f,scale:c})),y=()=>{var n;m("update:visible",!1),(n=o.onCancel)==null||n.call(o)},N=n=>{o.maskClosable&&n.target===n.currentTarget&&y()},_=()=>{r.value=r.value===0?360-p:r.value-p},h=()=>{r.value=(r.value+p)%360},S=()=>{C("zoomIn")},B=()=>{C("zoomOut")},I=()=>{z(),E()};return(n,i)=>{const a=e.resolveComponent("tl-icon"),s=e.resolveComponent("tl-tooltip");return e.openBlock(),e.createBlock(e.Teleport,{to:l.value,disabled:!l.value},[e.createVNode(e.Transition,{name:"preview-fade"},{default:e.withCtx(()=>[d.value?e.withDirectives((e.openBlock(),e.createElementBlock("div",{key:0,ref_key:"wrapperRef",ref:v,class:e.normalizeClass(e.unref(t).b()),style:e.normalizeStyle(w.value)},[e.createElementVNode("div",{class:e.normalizeClass(e.unref(t).e("mask")),onClick:N},null,2),e.createElementVNode("div",{class:e.normalizeClass(e.unref(t).e("body")),style:e.normalizeStyle({transform:`scale(${e.unref(c)}, ${e.unref(c)})`}),onClick:N},[e.createElementVNode("img",{ref_key:"imageRef",ref:f,src:o.src,class:e.normalizeClass(e.unref(t).e("img")),style:e.normalizeStyle({transform:`rotate(${r.value}deg) translate(${e.unref(b)[0]}px, ${e.unref(b)[1]}px)`})},null,14,M)],6),o.closable?(e.openBlock(),e.createElementBlock("button",{key:0,class:e.normalizeClass(e.unref(t).e("close-btn")),onClick:y},[e.createVNode(a,{icon:"fa-xmark"})],2)):e.createCommentVNode("",!0),o.previewGroup?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createElementVNode("button",{class:e.normalizeClass(e.unref(t).e("arrow-left")),style:e.normalizeStyle({zIndex:e.unref(u.popupManager).nextIndex()}),onClick:i[0]||(i[0]=$=>m("onPrev"))},[e.createVNode(a,{icon:"fa-angle-left"})],6),e.createElementVNode("button",{class:e.normalizeClass(e.unref(t).e("arrow-right")),style:e.normalizeStyle({zIndex:e.unref(u.popupManager).nextIndex()}),onClick:i[1]||(i[1]=$=>m("onNext"))},[e.createVNode(a,{icon:"fa-angle-right"})],6)],64)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(e.unref(t).e("toolbar")),style:e.normalizeStyle({zIndex:e.unref(u.popupManager).nextIndex()})},[e.createVNode(s,{placement:"top",title:"向左旋转","close-delay":0},{default:e.withCtx(()=>[e.createElementVNode("button",{class:e.normalizeClass(e.unref(t).e("toolbar-btn")),onClick:_},[e.createVNode(a,{icon:"fa-arrow-rotate-left"})],2)]),_:1}),e.createVNode(s,{placement:"top",title:"向右旋转","close-delay":0},{default:e.withCtx(()=>[e.createElementVNode("button",{class:e.normalizeClass(e.unref(t).e("toolbar-btn")),onClick:h},[e.createVNode(a,{icon:"fa-arrow-rotate-right"})],2)]),_:1}),e.createVNode(s,{placement:"top",title:"放大","close-delay":0},{default:e.withCtx(()=>[e.createElementVNode("button",{class:e.normalizeClass(e.unref(t).e("toolbar-btn")),onClick:S},[e.createVNode(a,{icon:"fa-plus "})],2)]),_:1}),e.createVNode(s,{placement:"top",title:"缩小","close-delay":0},{default:e.withCtx(()=>[e.createElementVNode("button",{class:e.normalizeClass(e.unref(t).e("toolbar-btn")),onClick:B},[e.createVNode(a,{icon:"fa-minus"})],2)]),_:1}),e.createVNode(s,{placement:"top",title:"原始比例","close-delay":0},{default:e.withCtx(()=>[e.createElementVNode("button",{class:e.normalizeClass(e.unref(t).e("toolbar-btn")),style:{width:"50px"},onClick:I},[e.createElementVNode("span",null,e.toDisplayString(e.unref(k.formatePercentage)(e.unref(c))),1)],2)]),_:1})],6)],6)),[[e.vShow,o.visible]]):e.createCommentVNode("",!0)]),_:1})],8,["to","disabled"])}}});module.exports=O;
