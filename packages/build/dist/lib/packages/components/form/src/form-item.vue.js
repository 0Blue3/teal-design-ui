"use strict";const vue=require("vue"),form=require("./form.js"),create=require("../../../utils/create.js"),utils=require("../../../utils/utils.js"),is=require("../../../utils/is.js"),index=require("../../../../node_modules/.pnpm/async-validator@4.2.5/node_modules/async-validator/dist-web/index.js"),isNil=require("../../../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/isNil.js"),_sfc_main=vue.defineComponent({name:"tl-form-item",__name:"form-item",props:{field:{},labelWidth:{default:116},label:{},required:{type:Boolean},rules:{},disabled:{type:Boolean}},setup(__props,{expose:__expose}){const bem=create.createNamespace("formItem"),formContext=vue.inject(form.formContextKey,{}),props=__props,validateStatus=vue.reactive({status:"primary",loading:!1,isError:!1,message:""}),propVal=vue.computed(()=>{const model=formContext==null?void 0:formContext.model;let value=eval(`model.${props.field}`);return model&&props.field&&!isNil(value)?value:null}),computedDisabled=vue.computed(()=>props.disabled||formContext.disabled),mergedLabelWidth=vue.computed(()=>(formContext==null?void 0:formContext.labelWidth)??props.labelWidth),mergedRules=vue.computed(()=>{var t;const e=[];if(props.rules&&e.push(...props.rules),props.field&&formContext.rules){const r=((t=formContext.rules)==null?void 0:t[props.field])??[];e.push(...r)}return props.required&&e.push({required:!0}),e}),mergedSize=vue.computed(()=>formContext.size||"m"),layout=vue.computed(()=>formContext.layout||"horizontal"),getTriggeredRules=e=>{let t=mergedRules.value;return e?t?t.filter(r=>is.isArray(r.trigger)?r.trigger.includes(e):r.trigger===e):[]:t},validateField=e=>{const t=getTriggeredRules(e);if(!props.field||t.length===0)return Promise.resolve();const r=props.field,l=propVal.value,o=new index({[r]:t});return validateStatus.loading=!0,o.validate({[r]:l}).then(()=>(validateStatus.isError=!1,validateStatus.status="success",validateStatus.message="",Promise.resolve())).catch(a=>{const{errors:s}=a;return validateStatus.isError=!0,validateStatus.status="error",validateStatus.message=s&&s.length>0&&s[0].message||"",Promise.resolve(a)}).finally(()=>{validateStatus.loading=!1})},resetValidate=()=>{props.field&&(validateStatus.isError=!1,validateStatus.loading=!1,validateStatus.status="primary",validateStatus.message="")},resetField=()=>{var t;resetValidate();const e=formContext==null?void 0:formContext.model;e&&props.field&&!isNil(e[props.field])&&(e[props.field]=(t=formItemInfo.value)==null?void 0:t.initValue)};let formItemInfo=vue.ref();return vue.onMounted(()=>{var e;props.field&&(formItemInfo.value=vue.reactive({field:props.field,disabled:computedDisabled,validateInstance:validateStatus,rules:mergedRules,initValue:utils.deepClone(propVal.value),validate:validateField,resetValidate,resetField}),(e=formContext.addField)==null||e.call(formContext,formItemInfo.value))}),vue.onBeforeMount(()=>{var e;(e=formContext.removeField)==null||e.call(formContext,props.field)}),__expose(formItemInfo.value),vue.provide(form.formItemContextKey,vue.reactive({size:mergedSize,layout,validateInstance:validateStatus,disabled:computedDisabled.value,validate:validateField})),(e,t)=>(vue.openBlock(),vue.createElementBlock("div",{class:vue.normalizeClass([vue.unref(bem).b(),vue.unref(bem).m(layout.value)])},[vue.createElementVNode("div",{class:vue.normalizeClass([vue.unref(bem).e("label"),vue.unref(bem).is("required",e.required??!1)]),style:vue.normalizeStyle({width:`${mergedLabelWidth.value}px`})},vue.toDisplayString(e.label),7),vue.createElementVNode("div",{class:vue.normalizeClass(vue.unref(bem).e("field"))},[vue.renderSlot(e.$slots,"default"),vue.createVNode(vue.Transition,{name:"fade"},{default:vue.withCtx(()=>[validateStatus.isError?(vue.openBlock(),vue.createElementBlock("div",{key:0,class:vue.normalizeClass(vue.unref(bem).e("field__extra"))},vue.toDisplayString(validateStatus.message),3)):vue.createCommentVNode("",!0)]),_:1})],2)],2))}});module.exports=_sfc_main;
