"use strict";const e=require("vue"),T=require("../../../utils/hooks/use-form-item.js"),h=require("../../../utils/create.js"),A=require("../../input/index.js"),d=require("./utils.js"),L=250,K=60,P=e.defineComponent({name:"tl-input-number",__name:"input-number",props:{modelValue:{},max:{default:1/0},min:{default:-1/0},step:{default:1},precision:{default:0},size:{default:"m"},disabled:{type:Boolean,default:!1},message:{},controls:{type:Boolean,default:!0},formatter:{type:Function,default:m=>m}},emits:["update:modelValue","increase","decrease"],setup(m,{emit:F}){const v=h.createNamespace("inputNumber"),f=F,l=m,p=e.ref(!1),b=e.ref(!1),u=e.toRefs(l),n=e.ref(0),C=e.ref(),{disabled:q,size:R}=u,{mergedSize:r,mergedDisabled:k}=T.useFormItem({disabled:q,size:R});let o;const s=e.computed(()=>{let t=u.precision.value;return(!Number.isInteger(t)||t>20)&&(t=0),t}),N=()=>l.max===1/0&&l.min===-1/0?0:l.min;let w,y;const M=t=>{if(l.disabled)return;const a=t===1?x:I;window.addEventListener("mouseup",i),w=window.setTimeout(()=>{y=window.setInterval(()=>{a()},K)},L)},i=()=>{w&&clearTimeout(w),y&&clearInterval(y),window.removeEventListener("mouseup",i)},V=e.computed(()=>l.disabled||n.value<=u.min.value),g=e.computed(()=>l.disabled||n.value>=u.max.value);e.onMounted(()=>{var t;n.value=((t=u.modelValue)==null?void 0:t.value)??N()});const x=()=>{if(g.value){i();return}o=d.calculate(n.value,u.step.value,s.value),n.value=o>=u.max.value?u.max.value:o,c(),f("increase")},I=()=>{if(V.value){i();return}o=d.calculate(n.value,-u.step.value,s.value),n.value=o<=u.min.value?u.min.value:o,c(),f("decrease")},$=t=>{t.key==="ArrowUp"&&x(),t.key==="ArrowDown"&&I()},E=()=>{c()},H=()=>{b.value=!0},S=t=>{var a;n.value=t?Number((t.match(d.numberMatchReg)??["0"])[0]):0,s.value===0?n.value=Math.trunc(n.value):n.value=d.normalizeNumber(n.value,s.value),g.value&&(n.value=u.max.value),V.value&&(n.value=u.min.value),c(),b.value=!1,(a=C.value)==null||a.setValue(B.value)},c=()=>{f("update:modelValue",n.value)},B=e.computed(()=>{const t=n.value.toFixed(s.value);return b.value?t:u.formatter.value(t)??t});return e.watch(()=>l.modelValue,t=>{n.value=t??N()}),(t,a)=>{const D=e.resolveComponent("tl-button");return e.openBlock(),e.createBlock(e.unref(A),e.mergeProps({ref_key:"inputRef",ref:C,"model-value":B.value,disabled:e.unref(k),size:e.unref(r),class:e.unref(v).b()},t.$attrs,{onFocus:H,onChange:E,onBlur:S,onHoverin:a[2]||(a[2]=z=>p.value=!0),onHoverout:a[3]||(a[3]=z=>p.value=!1),onKeydown:$}),{suffix:e.withCtx(()=>[e.withDirectives(e.createElementVNode("div",{class:e.normalizeClass([e.unref(v).e("buttons--number"),e.unref(v).em("buttons--number",e.unref(r))])},[e.createVNode(D,{disabled:g.value,size:e.unref(r),type:"secondary",onClick:x,onMousedown:a[0]||(a[0]=z=>M(1)),icon:"fa-angle-up"},null,8,["disabled","size"]),e.createVNode(D,{disabled:V.value,size:e.unref(r),type:"secondary",onClick:I,onMousedown:a[1]||(a[1]=z=>M(0)),icon:"fa-angle-down"},null,8,["disabled","size"])],2),[[e.vShow,t.controls&&!e.unref(k)&&p.value]])]),_:1},16,["model-value","disabled","size","class"])}}});module.exports=P;
